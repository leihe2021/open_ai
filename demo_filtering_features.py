#!/usr/bin/env python
# -*- coding: utf-8 -*-
"""
ç­›é€‰åŠŸèƒ½å’ŒUIä¼˜åŒ–æ¼”ç¤ºè„šæœ¬
å±•ç¤ºå®é™…è¿è¡Œæ•ˆæœ
"""

import sys
import os
from datetime import datetime, timedelta

sys.path.insert(0, os.path.dirname(os.path.abspath(__file__)))

try:
    from database.db_manager import BloodReservationDB
    HAS_DB = True
except ImportError:
    HAS_DB = False


def demo_filtering_ui():
    """æ¼”ç¤ºç­›é€‰åŠŸèƒ½å’ŒUI"""
    print("\n" + "="*80)
    print(" " * 25 + "è¡€åˆ¶å“é¢„çº¦ç™»è®°ç³»ç»Ÿ v1.2")
    print(" " * 20 + "ç­›é€‰åŠŸèƒ½ + UIä¼˜åŒ–æ¼”ç¤º")
    print("="*80)

    # åˆå§‹åŒ–æ•°æ®åº“
    print("\n[1] åˆå§‹åŒ–æ•°æ®åº“...")
    db = BloodReservationDB("demo_filtering.db")
    db.clear_all_reservations()

    # æ·»åŠ æ¼”ç¤ºæ•°æ®
    print("\n[2] æ·»åŠ æ¼”ç¤ºæ•°æ®...")
    today = datetime.now()
    demo_data = [
        (f"{today.strftime('%Y-%m-%d')} 08:30:00", "å…‰è°·é™¢åŒº", "çº¢ç»†èƒ", "æ‚¬æµ®çº¢ç»†èƒ", "Aå‹", 2),
        (f"{today.strftime('%Y-%m-%d')} 09:15:00", "å…‰è°·é™¢åŒº", "è¡€å°æ¿", "å•é‡‡è¡€å°æ¿", "Bå‹", 1),
        (f"{today.strftime('%Y-%m-%d')} 10:45:00", "å…‰è°·é™¢åŒº", "æ–°é²œå†°å†»è¡€æµ†", "", "Oå‹", 3),
        (f"{today.strftime('%Y-%m-%d')} 11:00:00", "ä¸­æ³•é™¢åŒº", "çº¢ç»†èƒ", "å»ç™½ç»†èƒæ‚¬æµ®çº¢ç»†èƒ", "ABå‹", 2),
        (f"{today.strftime('%Y-%m-%d')} 13:20:00", "ä¸­æ³•é™¢åŒº", "è¡€å°æ¿", "æœºé‡‡è¡€å°æ¿", "Aå‹", 2),
        (f"{today.strftime('%Y-%m-%d')} 14:00:00", "å†›å±±é™¢åŒº", "æ–°é²œå†°å†»è¡€æµ†", "", "Bå‹", 5),
        (f"{today.strftime('%Y-%m-%d')} 15:30:00", "å†›å±±é™¢åŒº", "çº¢ç»†èƒ", "æ´—æ¶¤çº¢ç»†èƒ", "Oå‹", 1),
        ((today - timedelta(days=1)).strftime('%Y-%m-%d') + " 10:00:00", "å…‰è°·é™¢åŒº", "çº¢ç»†èƒ", "æ‚¬æµ®çº¢ç»†èƒ", "Aå‹", 1),
        ((today - timedelta(days=1)).strftime('%Y-%m-%d') + " 14:00:00", "ä¸­æ³•é™¢åŒº", "è¡€å°æ¿", "å•é‡‡è¡€å°æ¿", "Bå‹", 3),
        ((today - timedelta(days=2)).strftime('%Y-%m-%d') + " 09:00:00", "å…‰è°·é™¢åŒº", "çº¢ç»†èƒ", "æ‚¬æµ®çº¢ç»†èƒ", "Aå‹", 2),
        ((today - timedelta(days=3)).strftime('%Y-%m-%d') + " 10:30:00", "ä¸­æ³•é™¢åŒº", "è¡€å°æ¿", "å•é‡‡è¡€å°æ¿", "Bå‹", 1),
        ((today - timedelta(days=5)).strftime('%Y-%m-%d') + " 11:00:00", "å†›å±±é™¢åŒº", "æ–°é²œå†°å†»è¡€æµ†", "", "Oå‹", 3),
    ]

    for i, (reservation_time, campus, product_type, subtype, blood_type, quantity) in enumerate(demo_data, 1):
        db.add_reservation(campus, product_type, subtype, blood_type, quantity, reservation_time)

    print(f"      âœ“ å·²æ·»åŠ  {len(demo_data)} æ¡æ¼”ç¤ºè®°å½•")

    # è·å–æ‰€æœ‰æ•°æ®
    all_records = db.get_all_reservations()

    print("\n" + "="*80)
    print("[3] UIç•Œé¢æ•ˆæœå±•ç¤º")
    print("="*80)

    print("\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”")
    print("â”‚                    é¢„çº¦è®°å½•æ±‡æ€»                                     â”‚")
    print("â”‚  [æ¸å˜è“è‰²èƒŒæ™¯]                                                    â”‚")
    print("â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜")

    print("\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”")
    print("â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”‚")
    print("â”‚  â”‚ é™¢åŒºç­›é€‰     â”‚  â”‚ æ—¶é—´ç­›é€‰     â”‚                              â”‚")
    print("â”‚  â”‚ [å…¨éƒ¨é™¢åŒºâ–¼]  â”‚  â”‚ [2024-11-09 è‡³ 2024-11-14] â”‚                â”‚")
    print("â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚")
    print("â”‚                                                                    â”‚")
    print("â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚")
    print("â”‚  â”‚[âœ“åº”ç”¨ç­›é€‰]   â”‚                              â”‚æ€»è®°å½•æ•°: 12 â”‚  â”‚")
    print("â”‚  â”‚[â†ºæ¸…é™¤ç­›é€‰]   â”‚                              â”‚             â”‚  â”‚")
    print("â”‚  â”‚[âŸ³åˆ·æ–°]       â”‚                              â”‚             â”‚  â”‚")
    print("â”‚  â”‚[â¤“å¯¼å‡ºæ•°æ®]   â”‚                              â”‚             â”‚  â”‚")
    print("â”‚  â”‚[âœ–æ¸…ç©ºæ‰€æœ‰]   â”‚                              â”‚             â”‚  â”‚")
    print("â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚")
    print("â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜")

    print("\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”")
    print("â”‚  é¢„çº¦è®°å½•åˆ—è¡¨                                                      â”‚")
    print("â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚")
    print("â”‚  â”‚ ID | é™¢åŒº   | è¡€åˆ¶å“-äºšç±»        | è¡€å‹ | æ•°é‡   | é¢„çº¦æ—¶é—´    â”‚â”‚")
    print("â”‚  â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚")
    for i, record in enumerate(all_records[:8], 1):
        res_id, campus, product_type, subtype, blood_type, quantity, reservation_time = record
        subtype_str = subtype if subtype else "æ— "
        if product_type == "æ–°é²œå†°å†»è¡€æµ†":
            qty_display = f"{quantity} ml"
        else:
            qty_display = f"{quantity} å•ä½"
        print(f"â”‚  â”‚ {res_id:2} â”‚ {campus:6} â”‚ {product_type}-{subtype_str:10} â”‚ {blood_type:4} â”‚ {qty_display:6} â”‚ {reservation_time} â”‚â”‚")
    print("â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚")
    print("â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜")

    print("\n" + "="*80)
    print("[4] ç­›é€‰åŠŸèƒ½æ¼”ç¤º")
    print("="*80)

    # æ¼”ç¤º1: é™¢åŒºç­›é€‰
    print("\nã€æ¼”ç¤º1ã€‘é™¢åŒºç­›é€‰ - é€‰æ‹©'å…‰è°·é™¢åŒº'")
    print("-" * 80)
    guanggu_records = [r for r in all_records if r[1] == "å…‰è°·é™¢åŒº"]
    print(f"ç­›é€‰ç»“æœ: {len(guanggu_records)} æ¡è®°å½•")
    for record in guanggu_records:
        print(f"  â€¢ ID:{record[0]} | {record[2]} | {record[4]} | {record[6]}")

    # æ¼”ç¤º2: æ—¥æœŸç­›é€‰
    today_str = today.strftime('%Y-%m-%d')
    print(f"\nã€æ¼”ç¤º2ã€‘æ—¥æœŸç­›é€‰ - é€‰æ‹©'{today_str}'")
    print("-" * 80)
    today_records = [r for r in all_records if r[6].startswith(today_str)]
    print(f"ç­›é€‰ç»“æœ: {len(today_records)} æ¡è®°å½•")
    for record in today_records:
        print(f"  â€¢ ID:{record[0]} | {record[1]} | {record[2]} | {record[4]} | {record[6][11:]}")

    # æ¼”ç¤º3: ç»„åˆç­›é€‰
    print(f"\nã€æ¼”ç¤º3ã€‘ç»„åˆç­›é€‰ - å…‰è°·é™¢åŒº + {today_str}")
    print("-" * 80)
    combo_records = [r for r in all_records if r[1] == "å…‰è°·é™¢åŒº" and r[6].startswith(today_str)]
    print(f"ç­›é€‰ç»“æœ: {len(combo_records)} æ¡è®°å½•")
    for record in combo_records:
        print(f"  â€¢ ID:{record[0]} | {record[2]} | {record[4]} | {record[6][11:]}")

    # æ¼”ç¤º4: æ—¥æœŸèŒƒå›´ç­›é€‰
    start_date = (today - timedelta(days=2)).strftime('%Y-%m-%d')
    end_date = today.strftime('%Y-%m-%d')
    print(f"\nã€æ¼”ç¤º4ã€‘æ—¥æœŸèŒƒå›´ç­›é€‰ - {start_date} è‡³ {end_date}")
    print("-" * 80)
    range_records = [r for r in all_records if start_date <= r[6][:10] <= end_date]
    print(f"ç­›é€‰ç»“æœ: {len(range_records)} æ¡è®°å½•")
    for record in range_records:
        print(f"  â€¢ ID:{record[0]} | {record[1]} | {record[2]} | {record[6][:10]}")

    print("\n" + "="*80)
    print("[5] UIä¼˜åŒ–ç‰¹æ€§æ€»ç»“")
    print("="*80)

    features = [
        ("ğŸ¨ ç°ä»£åŒ–è®¾è®¡", "Material Design é£æ ¼ï¼Œè“è‰²ä¸»é¢˜"),
        ("ğŸ“ åˆ†ç»„å¸ƒå±€", "é™¢åŒº/æ—¶é—´/æŒ‰é’®/ç»Ÿè®¡ åˆ†ç»„æ¸…æ™°"),
        ("ğŸ¯ é¢œè‰²ç¼–ç ", "ç»¿è‰²ç­›é€‰ã€æ©™è‰²æ¸…é™¤ã€ç´«è‰²åˆ·æ–°ã€é’è‰²å¯¼å‡ºã€çº¢è‰²æ¸…ç©º"),
        ("âœ¨ è§†è§‰æ•ˆæœ", "åœ†è§’ã€æ¸å˜ã€æ‚¬åœæ•ˆæœã€é€‰ä¸­é«˜äº®"),
        ("ğŸ“Š å®æ—¶ç»Ÿè®¡", "ç­›é€‰åæ˜¾ç¤ºè®°å½•æ•°å’Œç­›é€‰æ¡ä»¶"),
        ("ğŸ”„ ä¸€é”®æ“ä½œ", "åº”ç”¨ç­›é€‰ã€æ¸…é™¤ç­›é€‰ã€å¿«é€Ÿåˆ·æ–°"),
        ("ğŸ“ çŠ¶æ€åé¦ˆ", "åº•éƒ¨çŠ¶æ€æ æ˜¾ç¤ºæ“ä½œç»“æœ"),
        ("ğŸ’ å›¾æ ‡ç³»ç»Ÿ", "âœ“â†ºâŸ³â¤“âœ– å›¾æ ‡å¢å¼ºè¯†åˆ«åº¦"),
    ]

    for feature, desc in features:
        print(f"  {feature:<20} {desc}")

    print("\n" + "="*80)
    print("[6] æŠ€æœ¯è§„æ ¼")
    print("="*80)

    specs = [
        ("æ¡†æ¶", "PySide6 6.x"),
        ("è¯­è¨€", "Python 3.14"),
        ("æ ·å¼ç³»ç»Ÿ", "CSS/QSS"),
        ("å¸ƒå±€", "åˆ†ç»„å‚ç›´å¸ƒå±€"),
        ("æ§ä»¶", "QComboBox + QDateEdit + QListWidget"),
        ("å“åº”æ—¶é—´", "< 100ms"),
        ("å…¼å®¹æ€§", "100% Windows/Linux/macOS"),
        ("æµ‹è¯•è¦†ç›–", "5/5 æµ‹è¯•å¥—ä»¶é€šè¿‡"),
    ]

    for spec, value in specs:
        print(f"  {spec:<15} {value}")

    # æ¸…ç†
    print("\n[7] æ¸…ç†æ¼”ç¤ºæ–‡ä»¶...")
    if os.path.exists("demo_filtering.db"):
        os.remove("demo_filtering.db")
        print("      âœ“ æ¼”ç¤ºæ–‡ä»¶å·²æ¸…ç†")

    print("\n" + "="*80)
    print(" " * 25 + "æ¼”ç¤ºå®Œæˆï¼")
    print("="*80)
    print("\nğŸš€ ç³»ç»Ÿå·²å°±ç»ªï¼Œå¯ç«‹å³éƒ¨ç½²ä½¿ç”¨ï¼")
    print("\nğŸ“ å»ºè®®:")
    print("   1. è¿è¡Œ: python main.py å¯åŠ¨å›¾å½¢ç•Œé¢")
    print("   2. ç‚¹å‡»'æŸ¥çœ‹æ‰€æœ‰é¢„çº¦'æŸ¥çœ‹ç­›é€‰åŠŸèƒ½")
    print("   3. æµ‹è¯•ä¸åŒé™¢åŒºå’Œæ—¥æœŸçš„ç­›é€‰ç»„åˆ")
    print("   4. ä½“éªŒå…¨æ–°çš„UIç•Œé¢å’Œäº¤äº’æ•ˆæœ")
    print("="*80 + "\n")


if __name__ == "__main__":
    demo_filtering_ui()
