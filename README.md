# 血制品预约登记系统 v1.2

## 项目简介

血制品预约登记系统是专为医院分院设计的血制品预约管理工具，支持多院区血制品预约、数据筛选、表格化展示、数据导出等功能。

## 主要功能

### 预约登记功能
- ✅ 院区选择（光谷院区/中法院区/军山院区）
- ✅ 血制品预约（红细胞/血小板/新鲜冰冻血浆）
- ✅ 血型选择（A型/B型/O型/AB型）
- ✅ 数量输入（支持小数，0.1-10000）
- ✅ 自动记录预约时间

### 记录管理功能
- ✅ **表格化展示** - 标准7列表格格式，清晰对齐
- ✅ **院区筛选** - 按院区快速筛选记录
- ✅ **日期筛选** - 支持日期范围筛选（默认昨天→今天）
- ✅ **组合筛选** - 同时按院区和日期筛选
- ✅ **双击查看** - 双击记录查看详细信息
- ✅ **数据导出** - 支持Excel和CSV格式导出
- ✅ **记录清空** - 一键清空所有记录

### 界面特性
- ✅ Material Design风格，现代化UI
- ✅ 蓝色主题，视觉清晰
- ✅ 按钮颜色编码（筛选绿色、清除橙色等）
- ✅ 交替行颜色，提升可读性
- ✅ 响应式布局，窗口大小优化

## 系统要求

- Windows 10 及以上操作系统
- 无需安装 Python 环境（打包后）

## 安装说明

### 开发环境安装
1. 安装 Python 3.8+ 和 pip
2. 安装依赖包：
   ```bash
   pip install -r requirements.txt
   ```
3. 运行程序：
   ```bash
   python main.py
   ```

### 生产环境打包
1. Windows 系统运行：
   ```bash
   build.bat
   ```
2. Linux/Mac 系统运行：
   ```bash
   chmod +x build.sh
   ./build.sh
   ```
3. 打包完成后，可执行文件位于 `dist/` 目录

## 使用说明

### 1. 主界面预约登记
1. 选择院区（下拉菜单）
2. 选择血制品大类：
   - **红细胞** - 选择亚类（洗涤/辐照/悬浮/少白/稀有血型）
   - **血小板** - 选择亚类（单采/辐照/少白血小板）
   - **新鲜冰冻血浆** - 无亚类
3. 选择血型（单选按钮）
4. 输入数量（支持小数）
5. 系统自动记录当前时间
6. 点击"✓ 提交预约"保存信息

### 2. 查看预约记录
1. 点击"📋 查看所有预约"打开列表窗口
2. 查看表格化记录列表，包含：
   - ID、院区、血制品大类、血制品亚类、血型、数量、预约时间

### 3. 筛选功能
1. **院区筛选**：
   - 选择"全部院区"显示所有记录
   - 选择具体院区（光谷/中法/军山）仅显示该院区记录

2. **日期筛选**：
   - 设置开始日期和结束日期
   - 系统自动筛选该日期范围内的记录

3. **应用筛选**：
   - 点击"✓ 应用筛选"执行筛选
   - 统计信息显示筛选结果数量

4. **清除筛选**：
   - 点击"↺ 清除筛选"重置所有条件
   - 恢复显示所有记录

### 4. 数据导出
1. 在记录列表窗口点击"⤓ 导出数据"
2. 选择导出格式：
   - **Excel格式** (.xlsx) - 包含格式和颜色
   - **CSV格式** (.csv) - 通用格式，UTF-8编码
3. 选择保存路径并确认

### 5. 查看记录详情
- 在记录列表中双击任意记录
- 弹出详情窗口显示完整信息

### 6. 其他功能
- **⟳ 刷新** - 重新加载最新数据
- **✖ 清空所有** - 删除所有记录（需确认）
- **✖ 关闭** - 关闭窗口

## 目录结构

```
subscribe_transfusion/
├── main.py                           # 主程序入口
├── build.spec                        # PyInstaller 配置
├── requirements.txt                  # 依赖包列表
├── build.bat / build.sh              # 打包脚本
├── version_info.txt                  # 版本信息
├── README.md                         # 说明文档
├── DEVELOPMENT.md                    # 开发文档
├── CLAUDE.md                         # AI开发指南
├── gui/                              # 图形界面模块
│   ├── main_window.py                # 主窗口
│   └── reservation_list_window_simple.py  # 预约列表窗口
├── database/                         # 数据库模块
│   └── db_manager.py                 # 数据库管理
└── utils/                            # 工具模块
    ├── printer.py                    # PDF打印
    └── exporter_pyside6.py           # 数据导出
```

## 技术栈

- **GUI 框架**: PySide6
- **数据库**: SQLite
- **PDF 生成**: ReportLab
- **数据导出**: openpyxl (Excel), CSV
- **打包工具**: PyInstaller

## 数据存储

- 所有预约记录保存在 `records.db`（SQLite数据库）
- 数据库文件与可执行文件在同一目录
- 支持自动数据库结构升级
- 可使用 SQLite 管理工具（如 SQLiteBrowser）查看数据

## 版本历史

### v1.2 (2025-11-14)
- **新增**: 表格化预约记录列表（7列标准表格）
- **新增**: 院区筛选功能（全部/光谷/中法/军山）
- **新增**: 日期范围筛选（支持自定义日期区间）
- **新增**: 组合筛选（院区 + 日期同时筛选）
- **优化**: UI界面设计（Material Design风格）
- **优化**: 蓝色主题和视觉效果
- **优化**: 按钮颜色编码系统
- **优化**: 窗口尺寸调整（1100x750）
- **优化**: 表格列宽和对齐
- **修复**: PySide6 API兼容性问题
- **修复**: QTableWidget SelectionBehavior错误

### v1.1 (2025-11-13)
- **新增**: 数据导出功能（Excel/CSV）
- **新增**: 预约列表窗口
- **新增**: 数量字段（支持小数，升级INTEGER→REAL）
- **优化**: 数据库结构升级和自动迁移
- **修复**: GUI框架混合使用问题

### v1.0 (2024-11-11)
- **初始版本发布**
- **功能**: 基本预约登记功能
- **功能**: 院区选择、血制品选择、血型选择
- **功能**: PDF打印和数据库存储

## 常见问题

### Q: 程序无法启动
**A**: 检查Python环境是否正确安装，确保所有依赖包已安装

### Q: PDF中文显示乱码
**A**: 确保程序目录下的fonts文件夹包含simsun.ttc中文字体文件

### Q: 数据库升级失败
**A**: 系统会自动处理数据库升级，如有问题请备份原数据库文件

### Q: 导出Excel失败
**A**: 检查openpyxl是否正确安装，确保有文件写入权限

### Q: 表格显示异常
**A**: 确保使用PySide6 6.x版本，旧版本可能存在兼容性问题

### Q: 筛选功能不工作
**A**: 检查日期格式，确保使用正确的日期范围

## 技术支持

如有问题或建议，请联系：
- 开发团队：医院信息科
- 技术文档：查看 DEVELOPMENT.md
- AI开发指南：查看 CLAUDE.md

## 许可证

本软件仅供医院内部使用。

---

**版权信息**: © 2025 医院信息科 版权所有
