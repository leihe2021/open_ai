================================================================================
血制品预约登记系统 v1.1 - GUI功能说明
================================================================================

当前状态: 程序正在后台运行 (PID: 可见于任务管理器)

================================================================================
界面布局说明
================================================================================

主窗口 (600x500 像素):
┌─────────────────────────────────────────────────────────────────────┐
│                   血制品预约登记 v1.1                               │
│                              (标题，居中，大字体)                   │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  预约信息                                                        │
│  ┌───────────────────────────────────────────────────────────────┐ │
│  │ 院区: [请选择院区     ▼]                                      │ │
│  │                                                               │ │
│  │ 血制品大类: [请选择血制品大类 ▼]                              │ │
│  │                                                               │ │
│  │ 血制品亚类: [请选择血制品亚类 ▼]                              │ │
│  │            (根据大类动态加载选项)                             │ │
│  │                                                               │ │
│  │ 血型: ○A型  ○B型  ○O型  ○AB型                               │ │
│  │     (单选按钮组)                                              │ │
│  │                                                               │ │
│  │ 数量: [1.0] (0.1 - 10000)                                    │ │
│  │     (双精度微调框，支持小数)                                  │ │
│  │                                                               │ │
│  │ 预约时间: [2025-11-14 09:59:46]                              │ │
│  │            (只读，自动更新)                                   │ │
│  └───────────────────────────────────────────────────────────────┘ │
│                                                                     │
│  [提交预约]  [打印预约单]  [查看所有预约]                          │
│  (蓝色高亮)  (初始禁用)    (打开列表窗口)                         │
│                                                                     │
│  状态栏: 就绪                                                     │
└─────────────────────────────────────────────────────────────────────┘

================================================================================
功能操作流程
================================================================================

1. 【提交预约流程】
   Step 1: 选择院区
           ├─ 光谷院区
           ├─ 中法院区
           └─ 军山院区
   
   Step 2: 选择血制品大类
           ├─ 红细胞 (→ 显示5种亚类)
           │   ├─ 洗涤红细胞
           │   ├─ 辐照红细胞
           │   ├─ 悬浮红细胞
           │   ├─ 少白红细胞
           │   └─ 稀有血型红细胞
           ├─ 血小板 (→ 显示3种亚类)
           │   ├─ 单采血小板
           │   ├─ 辐照血小板
           │   └─ 少白血小板
           └─ 新鲜冰冻血浆 (→ 无亚类)
   
   Step 3: 选择血型 (单选)
           ○A型  ○B型  ○O型  ○AB型
   
   Step 4: 输入数量
           范围: 0.1 - 10000
           小数位: 1位
           单位: ml (血浆) / 单位 (其他)
   
   Step 5: 点击"提交预约"
           ├─ 验证输入完整性
           ├─ 保存到数据库
           ├─ 显示成功消息
           ├─ 自动启用"打印预约单"按钮
           └─ 更新状态栏

2. 【打印预约单流程】
   点击"打印预约单"按钮
   ├─ 根据当前记录生成PDF
   ├─ 文件名: blood_reservation_YYYYMMDD_HHMMSS.pdf
   ├─ 包含: 预约信息表格 + 打印时间
   └─ 显示保存成功消息

3. 【查看所有预约流程】
   点击"查看所有预约"按钮
   ├─ 打开新窗口 (1000x600)
   ├─ 显示所有预约记录表格
   ├─ 支持日期筛选
   ├─ 支持导出 (Excel/CSV)
   └─ 支持批量打印

================================================================================
数据库结构 (v1.1)
================================================================================

表: reservations
┌──────────────────────────┬──────────┬─────────────────────────┐
│ 字段                     │ 类型     │ 说明                    │
├──────────────────────────┼──────────┼─────────────────────────┤
│ id                       │ INTEGER  │ 主键，自增              │
│ hospital_campus          │ TEXT     │ 院区                    │
│ blood_product_type       │ TEXT     │ 血制品大类              │
│ blood_product_subtype    │ TEXT     │ 血制品亚类              │
│ blood_type               │ TEXT     │ 血型                    │
│ quantity                 │ REAL     │ 数量 (v1.1新增)        │
│ reservation_time         │ TEXT     │ 预约时间                │
└──────────────────────────┴──────────┴─────────────────────────┘

v1.1 升级点:
  + 新增 quantity 字段 (REAL类型，支持小数)
  - 删除 created_at 字段
  + 自动数据库迁移功能
  + 新增数据导出功能

================================================================================
文件输出说明
================================================================================

1. 【数据库文件】
   路径: ./records.db
   类型: SQLite3
   用途: 存储所有预约记录

2. 【PDF文件】
   单页: blood_reservation_YYYYMMDD_HHMMSS.pdf
   汇总: all_reservations_YYYYMMDD_HHMMSS.pdf
   字体: 自动检测中文字体

3. 【导出文件】
   Excel: 血制品预约记录_YYYYMMDD_HHMMSS.xlsx
   CSV:   血制品预约记录_YYYYMMDD_HHMMSS.csv
   编码: UTF-8 (CSV带BOM)

================================================================================
技术架构
================================================================================

前端框架: PySide6 (Qt for Python)
  ├─ QMainWindow - 主窗口
  ├─ QComboBox - 下拉选择
  ├─ QRadioButton - 单选按钮
  ├─ QDoubleSpinBox - 数量输入
  ├─ QPushButton - 操作按钮
  └─ QDateTimeEdit - 时间显示

后端模块:
  ├─ database/db_manager.py
  │   └─ BloodReservationDB 类
  │       ├─ 添加预约
  │       ├─ 查询记录
  │       ├─ 删除记录
  │       └─ 数据库迁移
  │
  ├─ utils/printer.py
  │   └─ BloodReservationPrinter 类
  │       ├─ 单页PDF生成
  │       ├─ 批量PDF生成
  │       └─ 中文字体处理
  │
  └─ utils/exporter.py
      └─ DataExporter 类
          ├─ Excel导出
          ├─ CSV导出
          └─ 文件对话框

构建工具: PyInstaller
  ├─ 配置文件: build.spec
  ├─ 输出: dist/BloodReservationSystem.exe
  └─ 大小: ~73MB

================================================================================
开发环境信息
================================================================================

Python版本: 3.11.14
Conda环境: blood_reservation
PySide6版本: 6.6.2
数据库: SQLite3
依赖库:
  - PySide6==6.6.2
  - reportlab==4.1.0
  - openpyxl==3.1.2
  - pyinstaller==6.4.0

测试状态: 8/8 通过 (100%)
  ✓ 模块导入测试
  ✓ 数据库功能测试
  ✓ 数据导出测试
  ✓ Qt API测试
  ✓ 打印功能测试
  ✓ 完整流程测试
  ✓ GUI启动测试
  ✓ 可执行文件构建测试

================================================================================
